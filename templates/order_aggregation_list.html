{% extends 'base_admin.html' %}
{% load static %}

{% block title %}注文食数確認{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item active">注文食数確認</li>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="text-center">
                <h2 class="mb-3">注文食数確認(製造作成表出力)</h2>
            </div>
        </div><!-- end col -->
    </div><!-- end row -->
     <div class="row">
        <div class="card-header py-1 messages">
            {% if messages %}
                {% for message in messages %}
                    <p{% if message.tags %} class="p-2 m-1 alert alert-{{ message.tags }}"{% endif %}>{{ message }}</p>
                {% endfor %}
            {% endif %}
        </div>
    </div>

   <div class="card shadow mt-4 mb-3">
        <h3 class="px-3">対象喫食日検索:</h3>
        <div class="form-group card-body px-4 mb-0 d-flex flex-row">
            <div class="col-3 form-inline">
                <form action="#" method="GET">
                    <div class="col-9 mb-2 form-inline">
                        {{ search_form }}
                    </div>
                    <div class="col-12 form-inline">
                            <button class="btn btn-primary mb-2" type="submit" formaction="">検索</button>
                            <button class="btn btn-primary mb-2" type="submit" formaction="{% url 'web_order:cooking_produce_export' %}" formmethod="GET">ファイル出力</button>
                    </div>
                </form>
            </div>
        </div>
                <h3 class="px-3 mb-3">食数合計:{{ total }}</h3>
                <table class="table table-striped dt-responsive nowrap w-100 px-3">
                    <thead>
                        <tr>
                            <th>朝食</th>
                            <th>昼食</th>
                            <th>夕食</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>{{ meals_total.0 }}</td>
                            <td>{{ meals_total.1 }}</td>
                            <td>{{ meals_total.2 }}</td>
                        </tr>
                    </tbody>
                </table>
    </div>

   <div class="card shadow mt-4 mb-3">
        <ul class="nav nav-tabs">
            <li class="nav-item">
              <a href="#aggregation" class="nav-link active" data-bs-toggle="tab">食数集計</a>
            </li>
            <li class="nav-item">
              <a href="#soup" class="nav-link" data-bs-toggle="tab">汁・具情報</a>
            </li>
            <li class="nav-item">
              <a href="#allergen" class="nav-link" data-bs-toggle="tab">アレルギー情報</a>
            </li>
        </ul>
        <div class="tab-content">
            <div id="aggregation" class="tab-pane active">
                <div class="card-body">
                    <div class="row">
                        <label class='col-2 btn-outline-primary col mr-2'>
                            <input type='radio' class='mx-3' name='display-condition' value='all' checked>全て
                        </label>
                        <label class='col-2 btn-outline-primary col mr-2'>
                            <input type='radio' class='mx-3' name='display-condition' value='joshoku'>常食(嚥下含む)のみ
                        </label>
                        <label class='col-2 btn-outline-primary col mr-2'>
                            <input type='radio' class='mx-3' name='display-condition' value='usuaji'>薄味のみ
                        </label>
                    </div>
                    <div class="table-responsive">
                        <table id="searchable-datatable" class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr>
                                    <th>呼び出し番号</th>
                                    <th>ユニット名</th>
                                    <th>献立種類</th>
                                    <th>朝食</th>
                                    <th>昼食</th>
                                    <th>夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for obj in object_list %}
                                    {% if obj.model.menu_name.menu_name == "薄味" %}
                                        <tr class="text-black bg-info">
                                    {% elif obj.model.menu_name.menu_name == "ソフト" %}
                                        <tr class="text-black bg-pink">
                                    {% elif obj.model.menu_name.menu_name == "ミキサー" %}
                                        <tr class="text-black bg-warning">
                                    {% elif obj.model.menu_name.menu_name == "ゼリー" %}
                                        <tr class="text-black bg-danger">
                                    {% else %}
                                        <tr>
                                    {% endif %}
                                        <td>{{ obj.model.unit_name.unit_number }}</td>

                                        {% if obj.model.unit_name.calc_name %}
                                            <td>{{ obj.model.unit_name.calc_name }}</td>
                                        {% else %}
                                            <td>{{ obj.model.unit_name }}</td>
                                        {% endif %}

                                        <td>{{ obj.model.menu_name }}</td>
                                        <td>{{ obj.morning }}</td>
                                        <td>{{ obj.lunch }}</td>
                                        <td>{{ obj.dinner }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
            <div id="allergen" class="tab-pane">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="allergen-datatable" class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr>
                                    <th>喫食日</th>
                                    <th>ユニット名</th>
                                    <th>食事区分</th>
                                    <th>献立種類</th>
                                    <th>アレルギー種類</th>
                                    <th>食数</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for obj in allergen_list %}
                                    {% if obj.menu_name.menu_name == "薄味" %}
                                        <tr class="text-black bg-info border-bottom-primary">
                                    {% elif obj.menu_name.menu_name == "ソフト" %}
                                        <tr class="text-black bg-pink">
                                    {% elif obj.menu_name.menu_name == "ミキサー" %}
                                        <tr class="text-black bg-warning">
                                    {% elif obj.menu_name.menu_name == "ゼリー" %}
                                        <tr class="text-black bg-danger">
                                    {% else %}
                                        <tr>
                                    {% endif %}
                                    <td>{{ obj.eating_day }}</td>
                                    <td>{{ obj.unit_name.calc_name }}</td>
                                    <td>{{ obj.meal_name }}</td>
                                    <td>{{ obj.menu_name }}</td>
                                    <td>{{ obj.allergen }}</td>
                                    <td>{{ obj.quantity }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
            <div id="soup" class="tab-pane">
                <div class="card-body">
                    <h3 class="px-3">常食:</h3>
                    <div class="table-responsive">
                        <table class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr class="bg-primary text-white ">
                                    <th></th>
                                    <th>△朝食</th>
                                    <th>〇昼食</th>
                                    <th>□夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>具のみ朝・昼</td>
                                    <td>{{ j_soup.g_b_l.0 }}</td>
                                    <td>{{ j_soup.g_b_l.1 }}</td>
                                    <td>{{ j_soup.g_b_l.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具朝・昼</td>
                                    <td>{{ j_soup.sg_b_l.0 }}</td>
                                    <td>{{ j_soup.sg_b_l.1 }}</td>
                                    <td>{{ j_soup.sg_b_l.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具昼・夕</td>
                                    <td>{{ j_soup.sg_l_d.0 }}</td>
                                    <td>{{ j_soup.sg_l_d.1 }}</td>
                                    <td>{{ j_soup.sg_l_d.2 }}</td>
                                </tr>
                                <tr>
                                    <td>具のみ3回</td>
                                    <td>{{ j_soup.g_3.0 }}</td>
                                    <td>{{ j_soup.g_3.1 }}</td>
                                    <td>{{ j_soup.g_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具3回</td>
                                    <td>{{ j_soup.sg_3.0 }}</td>
                                    <td>{{ j_soup.sg_3.1 }}</td>
                                    <td>{{ j_soup.sg_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>常食(汁無し)冷凍合計</td>
                                    <td>{{ j_soup.s_none.0 }}</td>
                                    <td>{{ j_soup.s_none.1 }}</td>
                                    <td>{{ j_soup.s_none.2 }}</td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                </div>
                <div class="card-body">
                    <h3 class="px-3">薄味:</h3>
                    <div class="table-responsive">
                        <table class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr class="bg-info text-white ">
                                    <th></th>
                                    <th>△朝食</th>
                                    <th>〇昼食</th>
                                    <th>□夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>具のみ朝・昼</td>
                                    <td>{{ u_soup.g_b_l.0 }}</td>
                                    <td>{{ u_soup.g_b_l.1 }}</td>
                                    <td>{{ u_soup.g_b_l.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具朝・昼</td>
                                    <td>{{ u_soup.sg_b_l.0 }}</td>
                                    <td>{{ u_soup.sg_b_l.1 }}</td>
                                    <td>{{ u_soup.sg_b_l.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具昼・夕</td>
                                    <td>{{ u_soup.sg_l_d.0 }}</td>
                                    <td>{{ u_soup.sg_l_d.1 }}</td>
                                    <td>{{ u_soup.sg_l_d.2 }}</td>
                                </tr>
                                <tr>
                                    <td>具のみ3回</td>
                                    <td>{{ u_soup.g_3.0 }}</td>
                                    <td>{{ u_soup.g_3.1 }}</td>
                                    <td>{{ u_soup.g_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具3回</td>
                                    <td>{{ u_soup.sg_3.0 }}</td>
                                    <td>{{ u_soup.sg_3.1 }}</td>
                                    <td>{{ u_soup.sg_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>常食(汁無し)冷凍合計</td>
                                    <td>{{ u_soup.s_none.0 }}</td>
                                    <td>{{ u_soup.s_none.1 }}</td>
                                    <td>{{ u_soup.s_none.2 }}</td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                </div>
                <div class="card-body">
                    <h3 class="px-3">フリーズ:</h3>
                    <div class="table-responsive">
                        <table class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr class="bg-secondary text-white ">
                                    <th></th>
                                    <th>△朝食</th>
                                    <th>〇昼食</th>
                                    <th>□夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>合計</td>
                                    <td>{{ freeze_counter.0 }}</td>
                                    <td>{{ freeze_counter.1 }}</td>
                                    <td>{{ freeze_counter.2 }}</td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                </div>
                <div class="card-body">
                    <h3 class="px-3">ソフト:</h3>
                    <div class="table-responsive">
                        <table class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr class="bg-pink text-white ">
                                    <th></th>
                                    <th>△朝食</th>
                                    <th>〇昼食</th>
                                    <th>□夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>汁と具 朝・昼</td>
                                    <td>{{ s_soup.sg_b_l.0 }}</td>
                                    <td>{{ s_soup.sg_b_l.1 }}</td>
                                    <td>{{ s_soup.sg_b_l.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具 昼・夕</td>
                                    <td>{{ s_soup.sg_l_d.0 }}</td>
                                    <td>{{ s_soup.sg_l_d.1 }}</td>
                                    <td>{{ s_soup.sg_l_d.2 }}</td>
                                </tr>
                                <tr>
                                    <td>具のみ3回</td>
                                    <td>{{ s_soup.g_3.0 }}</td>
                                    <td>{{ s_soup.g_3.1 }}</td>
                                    <td>{{ s_soup.g_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具3回</td>
                                    <td>{{ s_soup.sg_3.0 }}</td>
                                    <td>{{ s_soup.sg_3.1 }}</td>
                                    <td>{{ s_soup.sg_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁なし</td>
                                    <td>{{ s_soup.s_none.0 }}</td>
                                    <td>{{ s_soup.s_none.1 }}</td>
                                    <td>{{ s_soup.s_none.2 }}</td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                </div>
                <div class="card-body">
                    <h3 class="px-3">ミキサー:</h3>
                    <div class="table-responsive">
                        <table class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr class="bg-warning text-white ">
                                    <th></th>
                                    <th>△朝食</th>
                                    <th>〇昼食</th>
                                    <th>□夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>汁と具 朝・昼</td>
                                    <td>{{ m_soup.sg_b_l.0 }}</td>
                                    <td>{{ m_soup.sg_b_l.1 }}</td>
                                    <td>{{ m_soup.sg_b_l.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具 昼・夕</td>
                                    <td>{{ m_soup.sg_l_d.0 }}</td>
                                    <td>{{ m_soup.sg_l_d.1 }}</td>
                                    <td>{{ m_soup.sg_l_d.2 }}</td>
                                </tr>
                                <tr>
                                    <td>具のみ3回</td>
                                    <td>{{ m_soup.g_3.0 }}</td>
                                    <td>{{ m_soup.g_3.1 }}</td>
                                    <td>{{ m_soup.g_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具3回</td>
                                    <td>{{ m_soup.sg_3.0 }}</td>
                                    <td>{{ m_soup.sg_3.1 }}</td>
                                    <td>{{ m_soup.sg_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁なし</td>
                                    <td>{{ m_soup.s_none.0 }}</td>
                                    <td>{{ m_soup.s_none.1 }}</td>
                                    <td>{{ m_soup.s_none.2 }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-body">
                    <h3 class="px-3">ゼリー:</h3>
                    <div class="table-responsive">
                        <table class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr class="bg-danger text-white ">
                                    <th></th>
                                    <th>△朝食</th>
                                    <th>〇昼食</th>
                                    <th>□夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>汁と具 朝・昼</td>
                                    <td>{{ z_soup.sg_b_l.0 }}</td>
                                    <td>{{ z_soup.sg_b_l.1 }}</td>
                                    <td>{{ z_soup.sg_b_l.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具 昼・夕</td>
                                    <td>{{ z_soup.sg_l_d.0 }}</td>
                                    <td>{{ z_soup.sg_l_d.1 }}</td>
                                    <td>{{ z_soup.sg_l_d.2 }}</td>
                                </tr>
                                <tr>
                                    <td>具のみ3回</td>
                                    <td>{{ z_soup.g_3.0 }}</td>
                                    <td>{{ z_soup.g_3.1 }}</td>
                                    <td>{{ z_soup.g_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁と具3回</td>
                                    <td>{{ z_soup.sg_3.0 }}</td>
                                    <td>{{ z_soup.sg_3.1 }}</td>
                                    <td>{{ z_soup.sg_3.2 }}</td>
                                </tr>
                                <tr>
                                    <td>汁なし</td>
                                    <td>{{ z_soup.s_none.0 }}</td>
                                    <td>{{ z_soup.s_none.1 }}</td>
                                    <td>{{ z_soup.s_none.2 }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-body">
                    <h3 class="px-3">木沢・個食:</h3>
                    <div class="table-responsive">
                        <table class="table dt-responsive nowrap w-100">
                            <thead>
                                <tr class="bg-success text-white ">
                                    <th></th>
                                    <th>△朝食</th>
                                    <th>〇昼食</th>
                                    <th>□夕食</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>合計</td>
                                    <td>{{ koshoku_counter.0 }}</td>
                                    <td>{{ koshoku_counter.1 }}</td>
                                    <td>{{ koshoku_counter.2 }}</td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>
   </div>
</div>

{% endblock %}
{% block scripts %}
<script>
    $.fn.dataTable.ext.search.push(function(settings, data, dataIndex){
        var radio_val = $( 'input[name="display-condition"]:radio:checked' ).val();
        if (radio_val == "all")
        {
            return true;
        }
        if (radio_val == "usuaji")
        {
            if (data[2] == "薄味")
                return true;
            else
                return false;
        }

        return data[2] != "薄味";
    })
    $(document).ready(function() {
        var table = $('#searchable-datatable').DataTable({
            searching: true,
            stateSave: false,

            lengthMenu: [ 50, 100, 150, 200 ],
            displayLength: 150,

            "order": [],

            "language": {
                "paginate": {
                    "previous": "<i class='mdi mdi-chevron-left'>",
                    "next": "<i class='mdi mdi-chevron-right'>"
                }
            },
            "drawCallback": function () {
                $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
            },
        });

        var table2 = $('#allergen-datatable').DataTable({
            searching: true,
            stateSave: false,

            lengthMenu: [ 50, 100, 150, 200 ],
            displayLength: 100,

            "order": [],

            "language": {
                "paginate": {
                    "previous": "<i class='mdi mdi-chevron-left'>",
                    "next": "<i class='mdi mdi-chevron-right'>"
                }
            },
            "drawCallback": function () {
                $('.dataTables_paginate > .pagination').addClass('pagination-rounded');
            },
        });

        // Event listener to the two range filtering inputs to redraw on input
        $( 'input[name="display-condition"]:radio' ).change( function() {
            table.draw();
        } );
    } );
</script>
{% endblock %}
